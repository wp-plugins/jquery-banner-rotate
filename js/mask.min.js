!function(a){function b(){var a=document.createElement("input"),b="onpaste";return a.setAttribute(b,""),"function"==typeof a[b]?"paste":"input"}var g,c=b()+".mask",d=navigator.userAgent,e=/iphone/i.test(d),f=/android/i.test(d);a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},a.fn.extend({caret:function(a,b){var c;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof a?(b="number"==typeof b?b:a,this.each(function(){this.setSelectionRange?this.setSelectionRange(a,b):this.createTextRange&&(c=this.createTextRange(),c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select())})):(this[0].setSelectionRange?(a=this[0].selectionStart,b=this[0].selectionEnd):document.selection&&document.selection.createRange&&(c=document.selection.createRange(),a=0-c.duplicate().moveStart("character",-1e5),b=a+c.text.length),{begin:a,end:b})},unmask:function(){return this.trigger("unmask")},mask:function(b,d){var h,i,j,k,l,m;return!b&&this.length>0?(h=a(this[0]),h.data(a.mask.dataName)()):(d=a.extend({placeholder:a.mask.placeholder,completed:null},d),i=a.mask.definitions,j=[],k=m=b.length,l=null,a.each(b.split(""),function(a,b){"?"==b?(m--,k=a):i[b]?(j.push(new RegExp(i[b])),null===l&&(l=j.length-1)):j.push(null)}),this.trigger("unmask").each(function(){function p(a){for(;++a<m&&!j[a];);return a}function q(a){for(;--a>=0&&!j[a];);return a}function r(a,b){var c,e;if(!(0>a)){for(c=a,e=p(b);m>c;c++)if(j[c]){if(!(m>e&&j[c].test(n[e])))break;n[c]=n[e],n[e]=d.placeholder,e=p(e)}w(),h.caret(Math.max(l,a))}}function s(a){var b,c,e,f;for(b=a,c=d.placeholder;m>b;b++)if(j[b]){if(e=p(b),f=n[b],n[b]=c,!(m>e&&j[e].test(f)))break;c=f}}function t(a){var c,d,f,b=a.which;8===b||46===b||e&&127===b?(c=h.caret(),d=c.begin,f=c.end,0===f-d&&(d=46!==b?q(d):f=p(d-1),f=46===b?p(f):f),v(d,f),r(d,f-1),a.preventDefault()):27==b&&(h.val(o),h.caret(0,x()),a.preventDefault())}function u(b){var g,i,k,c=b.which,e=h.caret();b.ctrlKey||b.altKey||b.metaKey||32>c||c&&(0!==e.end-e.begin&&(v(e.begin,e.end),r(e.begin,e.end-1)),g=p(e.begin-1),m>g&&(i=String.fromCharCode(c),j[g].test(i)&&(s(g),n[g]=i,w(),k=p(g),f?setTimeout(a.proxy(a.fn.caret,h,k),0):h.caret(k),d.completed&&k>=m&&d.completed.call(h))),b.preventDefault())}function v(a,b){var c;for(c=a;b>c&&m>c;c++)j[c]&&(n[c]=d.placeholder)}function w(){h.val(n.join(""))}function x(a){var e,f,b=h.val(),c=-1;for(e=0,pos=0;m>e;e++)if(j[e]){for(n[e]=d.placeholder;pos++<b.length;)if(f=b.charAt(pos-1),j[e].test(f)){n[e]=f,c=e;break}if(pos>b.length)break}else n[e]===b.charAt(pos)&&e!==k&&(pos++,c=e);return a?w():k>c+1?(h.val(""),v(0,m)):(w(),h.val(h.val().substring(0,c+1))),k?e:l}var h=a(this),n=a.map(b.split(""),function(a){return"?"!=a?i[a]?d.placeholder:a:void 0}),o=h.val();h.data(a.mask.dataName,function(){return a.map(n,function(a,b){return j[b]&&a!=d.placeholder?a:null}).join("")}),h.attr("readonly")||h.one("unmask",function(){h.unbind(".mask").removeData(a.mask.dataName)}).bind("focus.mask",function(){clearTimeout(g);var a;o=h.val(),a=x(),g=setTimeout(function(){w(),a==b.length?h.caret(0,a):h.caret(a)},10)}).bind("blur.mask",function(){x(),h.val()!=o&&h.change()}).bind("keydown.mask",t).bind("keypress.mask",u).bind(c,function(){setTimeout(function(){var a=x(!0);h.caret(a),d.completed&&a==h.val().length&&d.completed.call(h)},0)}),x()}))}})}(jQuery);